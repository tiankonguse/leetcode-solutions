# 费用流

给定一个网络 `G=(V,E)`，每条边除了有容量限制 `c(u,v)`，还有一个单位流量的费用 `w(u,v)`。

当 `(u,v)` 的流量为 `f(u,v)` 时，需要花费 `f(u,v) * w(u,v)` 的费用。

`w` 也满足斜对称性，即 `w(u,v)=-w(v,u)`。

则该网络中总花费最小的最大流称为 最小费用最大流，即在最大化 `f(s,v)` 的前提下最小化 `sumf(u,v) * w(u,v)`。


## SSP 算法 - 无负圈

SSP（Successive Shortest Path）算法是一个贪心的算法。它的思路是每次寻找单位费用最小的增广路进行增广，直到图上不存在增广路为止。

如果图上存在单位费用为负的圈，SSP 算法无法正确求出该网络的最小费用最大流。此时需要先使用消圈算法消去图上的负圈。


### 时间复杂度

如果使用 Bellman–Ford 算法 求解最短路，每次找增广路的时间复杂度为 O(nm)。  
设该网络的最大流为 f，则最坏时间复杂度为 O(nmf)。
事实上，SSP 算法是 伪多项式时间 的。


### 实现

只需将 EK 算法或 Dinic 算法中找增广路的过程，替换为用最短路算法寻找单位费用最小的增广路即可。


EK 模板代码：[ek-min-cost.cpp](./ek-min-cost.cpp)
EK 模板代码：[dinic-min-cost.cpp](./dinic-min-cost.cpp)


## Primal-Dual 原始对偶算法 - 负圈

用 Bellman–Ford 求解最短路的时间复杂度为 O(nm)，无论在稀疏图上还是稠密图上都不及 Dijkstra 算法2。
但网络上存在单位费用为负的边，因此无法直接使用 Dijkstra 算法。


Primal-Dual 原始对偶算法的思路与 Johnson 全源最短路径算法 类似，通过为每个点设置一个势能，将网络上所有边的费用（下面简称为边权）全部变为非负值，从而可以应用 Dijkstra 算法找出网络上单位费用最小的增广路。

首先跑一次最短路，求出源点到每个点的最短距离（也是该点的初始势能）h_i。接下来和 Johnson 算法一样，对于一条从 u 到 v，单位费用为 w 的边，将其边权重置为 `w+h_u-h_v`。

可以发现，这样设置势能后新网络上的最短路径和原网络上的最短路径一定对应。证明在介绍 Johnson 算法时已经给出，这里不再展开。

与常规的最短路问题不同的是，每次增广后图的形态会发生变化，这种情况下各点的势能需要更新。

如何更新呢？先给出结论，设增广后从源点到 i 号点的最短距离为 
`d'_i`（这里的距离为重置每条边边权后得到的距离），只需给 `h_i` 加上 `d'_i` 即可。

模板代码：[primal-dual-min-cost.cpp](./primal-dual-min-cost.cpp)